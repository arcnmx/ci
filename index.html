<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CI/nix Manual</title><link rel="stylesheet" type="text/css" href="style.css" /><link rel="stylesheet" type="text/css" href="overrides.css" /><link rel="stylesheet" type="text/css" href="mono-blue.css" /><script src="highlight.pack.js" type="text/javascript"></script><script src="highlight.load.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><link rel="home" href="index.html" title="CI/nix Manual" /><link rel="next" href="options.html" title="Appendix A. Configuration Options" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">CI/nix Manual</th></tr><tr><td width="20%" align="left"> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="options.html">Next</a></td></tr></table><hr /></div><div class="book"><div class="titlepage"><div><div><h1 class="title"><a id="book-ci-manual"></a>CI/nix Manual</h1></div></div><hr /></div><div class="toc"><dl class="toc"><dt><span class="preface"><a href="index.html#idm140737328835872">CI/nix</a></span></dt><dt><span class="chapter"><a href="index.html#ch-setup">1. Setup</a></span></dt><dt><span class="chapter"><a href="index.html#ch-commands">2. Commands</a></span></dt><dt><span class="chapter"><a href="index.html#ch-examples">3. Examples</a></span></dt><dt><span class="chapter"><a href="index.html#ch-configuration">4. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#sec-configuration-options">4.1. Options</a></span></dt><dt><span class="section"><a href="index.html#sec-configuration-env">4.2. Environment</a></span></dt></dl></dd><dt><span class="appendix"><a href="options.html">A. Configuration Options</a></span></dt><dt><span class="appendix"><a href="env.html">B. Environment Variables</a></span></dt><dd><dl><dt><span class="section"><a href="env.html#sec-env-input">B.1. Input</a></span></dt><dt><span class="section"><a href="env.html#sec-env-output">B.2. Output</a></span></dt></dl></dd></dl></div><div class="preface"><div class="titlepage"><div><div><h1 class="title"><a id="idm140737328835872"></a>CI/nix</h1></div></div></div><p>
      <a class="link" href="https://github.com/arcnmx/ci" target="_top">CI</a> is a declarative continuous
      integration and testing system built on top of Nix and the NixOS module system. Its aim is to
      be flexible in order to meet the many needs of the various technologies and cloud providers in
      use with CI today, while being simple and self-contained so that all actions can be performed
      on a local machine. Build results should be reproducible so if it works on your machine then
      it will work on the CI server as well!
    </p><p>
      Some of the project's goals and features are...
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The same reproducibility guarantees provided by the Nix and NixOS ecosystem, offering consistent builds that will produce the same results whether they run on your laptop or in the cloud.
      </p></li><li class="listitem"><p>
        Matrix builds that run locally as well as on remote CI servers.
      </p></li><li class="listitem"><p>
        Integration with the Nix store to cache and avoid repeating unnecessary work.
      </p></li><li class="listitem"><p>
        Included escape hatches for tests, commands, and deployments that require the network or other resources that would normally be restricted by using Nix.
      </p></li><li class="listitem"><p>
        Integration with existing CI providers while being agnostic to the underlying service, allowing the same configuration to work with multiple providers while still providing dashboards and results that reflect your configuration.
      </p></li><li class="listitem"><p>
        Ability to publish results and perform follow-up actions and notifications without being constrained to any particular provider's capabilities.
      </p></li></ul></div><p>
      (this is currently all very much WIP right now, but please do <a class="link" href="https://github.com/arcnmx/ci/issues" target="_top">file issues</a> if you actually use it and have questions or concerns!)
    </p></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="ch-setup"></a>Chapter 1. Setup</h1></div></div></div><p>
      To start, it's covenient to have the <code class="literal">ci</code> channel available to nix on your
      system:
    </p><pre class="screen">
      <code class="prompt">$</code> <strong class="userinput"><code>export NIX_PATH=$NIX_PATH:ci=https://github.com/arcnmx/ci/archive/master.tar.gz</code></strong>
    </pre><p>
      This allows the channel to be easily referred to while testing locally, like so:
    </p><pre class="screen">
      <code class="prompt">$</code> <strong class="userinput"><code>nix run ci.help</code></strong>
      <code class="prompt">$</code> <strong class="userinput"><code>nix run --arg config '&lt;ci/examples/ci.nix&gt;' ci.test</code></strong>
      <code class="computeroutput">✔️ hello, world ok</code>
    </pre><p>
      You can also manage it with <code class="literal">nix-channel</code>, though due to a nix limitation you
      are still required to include the channel name in <code class="literal">NIX_PATH</code> in some way:
    </p><pre class="screen">
      <code class="prompt">$</code> <strong class="userinput"><code>nix-channel --add https://github.com/arcnmx/ci/archive/master.tar.gz ci</code></strong>
      <code class="prompt">$</code> <strong class="userinput"><code>nix-channel --update</code></strong>
      <code class="prompt">$</code> <strong class="userinput"><code>export NIX_PATH=$NIX_PATH:ci=/xxx</code></strong>
    </pre></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="ch-commands"></a>Chapter 2. Commands</h1></div></div></div><p>
      Global and CI commands can be found with the list command:
    </p><pre class="screen">
      <code class="prompt">$</code> <strong class="userinput"><code>nix run ci.list</code></strong>
      <code class="computeroutput">list</code>
      <code class="computeroutput">run.gh-actions-generate</code>
      <code class="computeroutput">run.test.example</code>
      <code class="computeroutput">test</code>
    </pre><p>
      Commands under a job or stage sub-configuration can be accessed by name via
      <code class="literal">ci.job.jobName.run</code> and <code class="literal">ci.stage.name.run</code> respectively.
    </p></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="ch-examples"></a>Chapter 3. Examples</h1></div></div></div><p>
      Documentation is a bit sparse right now, but a few examples are currently available:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <a class="link" href="https://github.com/arcnmx/ci/blob/master/examples/ci.nix#blob-path" target="_top"> Example</a> and <a class="link" href="https://github.com/arcnmx/ci/runs/251473028" target="_top">associated dashboard</a>
      </p></li><li class="listitem"><p>
        <a class="link" href="https://github.com/arcnmx/ci/tree/master/tests" target="_top">CI Tests</a>
      </p></li><li class="listitem"><p>
        <a class="link" href="https://github.com/arcnmx/nixexprs-rust/blob/master/ci.nix#blob-path" target="_top">rust channel tests</a>
      </p></li></ul></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="ch-configuration"></a>Chapter 4. Configuration</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-configuration-options"></a>4.1. Options</h2></div></div></div><p>
        <a class="xref" href="options.html" title="Appendix A. Configuration Options">Appendix A, <em>Configuration Options</em></a> lists all the options available for customizing your CI
        process!
      </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-configuration-env"></a>4.2. Environment</h2></div></div></div><p>
        <a class="xref" href="env.html" title="Appendix B. Environment Variables">Appendix B, <em>Environment Variables</em></a> documents the environment variables provided by and used for
        configuring the CI. It may be convenient to set some of these for a project in the relevant
        <code class="literal">shell.nix</code> or <code class="literal">.direnv</code> files.
      </p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="options.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"> </td><td width="40%" align="right" valign="top"> Appendix A. Configuration Options</td></tr></table></div></body></html>